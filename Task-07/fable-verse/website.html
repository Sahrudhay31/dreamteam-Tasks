<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BookHaven - A Social Platform for Book Lovers</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/babel-standalone@7.22.5/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;

    // Mock data for books
    const mockBooks = [
      { id: 1, title: "Pride and Prejudice", author: "Jane Austen", genre: "Romance", year: 1813 },
      { id: 2, title: "1984", author: "George Orwell", genre: "Dystopian", year: 1949 },
      { id: 3, title: "The Hobbit", author: "J.R.R. Tolkien", genre: "Fantasy", year: 1937 },
    ];

    // Main App Component
    function App() {
      const [user, setUser] = useState(null);
      const [books, setBooks] = useState(mockBooks);
      const [searchQuery, setSearchQuery] = useState("");
      const [readingList, setReadingList] = useState([]);
      const [reviews, setReviews] = useState([]);

      // Simulated user authentication
      const handleLogin = (username, password) => {
        setUser({ username });
        localStorage.setItem("user", JSON.stringify({ username }));
      };

      const handleLogout = () => {
        setUser(null);
        localStorage.removeItem("user");
      };

      // Load user from localStorage on mount
      useEffect(() => {
        const storedUser = localStorage.getItem("user");
        if (storedUser) setUser(JSON.parse(storedUser));
      }, []);

      // Search functionality
      const filteredBooks = books.filter(
        (book) =>
          book.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
          book.author.toLowerCase().includes(searchQuery.toLowerCase()) ||
          book.genre.toLowerCase().includes(searchQuery.toLowerCase())
      );

      // Add to reading list
      const addToReadingList = (bookId) => {
        if (!readingList.includes(bookId)) {
          setReadingList([...readingList, bookId]);
        }
      };

      // Add review
      const addReview = (bookId, rating, comment) => {
        if (!user) return alert("Please log in to leave a review.");
        setReviews([...reviews, { bookId, user: user.username, rating, comment }]);
      };

      // Delete review
      const deleteReview = (index) => {
        setReviews(reviews.filter((_, i) => i !== index));
      };

      return (
        <div className="min-h-screen bg-gray-100">
          <header className="bg-blue-600 text-white p-4">
            <div className="container mx-auto flex justify-between items-center">
              <h1 className="text-2xl font-bold">BookHaven</h1>
              <nav>
                {user ? (
                  <div className="flex items-center space-x-4">
                    <span>Welcome, {user.username}!</span>
                    <button
                      onClick={handleLogout}
                      className="bg-red-500 px-4 py-2 rounded hover:bg-red-600"
                    >
                      Logout
                    </button>
                  </div>
                ) : (
                  <LoginForm onLogin={handleLogin} />
                )}
              </nav>
            </div>
          </header>

          <main className="container mx-auto p-4">
            {!user ? (
              <div className="text-center">
                <h2 className="text-xl font-semibold mb-4">Welcome to BookHaven</h2>
                <p>Please log in to access all features.</p>
              </div>
            ) : (
              <>
                <SearchBar searchQuery={searchQuery} setSearchQuery={setSearchQuery} />
                <BookList
                  books={filteredBooks}
                  addToReadingList={addToReadingList}
                  readingList={readingList}
                  reviews={reviews}
                  addReview={addReview}
                  deleteReview={deleteReview}
                  user={user}
                />
                <ReadingList books={books} readingList={readingList} />
              </>
            )}
          </main>
        </div>
      );
    }

    // Login Form Component
    function LoginForm({ onLogin }) {
      const [username, setUsername] = useState("");
      const [password, setPassword] = useState("");

      const handleSubmit = (e) => {
        e.preventDefault();
        if (username && password) {
          onLogin(username, password);
          setUsername("");
          setPassword("");
        } else {
          alert("Please enter both username and password.");
        }
      };

      return (
        <div className="flex space-x-2">
          <input
            type="text"
            placeholder="Username"
            value={username}
            onChange={(e) => setUsername(e.target.value)}
            className="px-2 py-1 rounded border"
          />
          <input
            type="password"
            placeholder="Password"
            value={password}
            onChange={(e) => setPassword(e.target.value)}
            className="px-2 py-1 rounded border"
          />
          <button
            onClick={handleSubmit}
            className="bg-green-500 px-4 py-2 rounded hover:bg-green-600 text-white"
          >
            Login
          </button>
        </div>
      );
    }

    // Search Bar Component
    function SearchBar({ searchQuery, setSearchQuery }) {
      return (
        <div className="mb-6">
          <input
            type="text"
            placeholder="Search by title, author, or genre..."
            value={searchQuery}
            onChange={(e) => setSearchQuery(e.target.value)}
            className="w-full p-2 rounded border"
          />
        </div>
      );
    }

    // Book List Component
    function BookList({ books, addToReadingList, readingList, reviews, addReview, deleteReview, user }) {
      return (
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          {books.map((book) => (
            <div key={book.id} className="bg-white p-4 rounded shadow">
              <h3 className="text-lg font-semibold">{book.title}</h3>
              <p>Author: {book.author}</p>
              <p>Genre: {book.genre}</p>
              <p>Year: {book.year}</p>
              <button
                onClick={() => addToReadingList(book.id)}
                disabled={readingList.includes(book.id)}
                className={`mt-2 px-4 py-2 rounded ${
                  readingList.includes(book.id)
                    ? "bg-gray-400 cursor-not-allowed"
                    : "bg-blue-500 hover:bg-blue-600 text-white"
                }`}
              >
                {readingList.includes(book.id) ? "In Reading List" : "Add to Reading List"}
              </button>
              <ReviewForm bookId={book.id} addReview={addReview} />
              <ReviewList
                reviews={reviews.filter((r) => r.bookId === book.id)}
                deleteReview={deleteReview}
                user={user}
              />
            </div>
          ))}
        </div>
      );
    }

    // Review Form Component
    function ReviewForm({ bookId, addReview }) {
      const [rating, setRating] = useState(0);
      const [comment, setComment] = useState("");

      const handleSubmit = () => {
        if (rating && comment) {
          addReview(bookId, rating, comment);
          setRating(0);
          setComment("");
        } else {
          alert("Please provide both rating and comment.");
        }
      };

      return (
        <div className="mt-4">
          <select
            value={rating}
            onChange={(e) => setRating(Number(e.target.value))}
            className="p-2 border rounded"
          >
            <option value="0">Select Rating</option>
            {[1, 2, 3, 4, 5].map((num) => (
              <option key={num} value={num}>{num} Stars</option>
            ))}
          </select>
          <textarea
            value={comment}
            onChange={(e) => setComment(e.target.value)}
            placeholder="Write your review..."
            className="w-full p-2 mt-2 border rounded"
          />
          <button
            onClick={handleSubmit}
            className="mt-2 px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600"
          >
            Submit Review
          </button>
        </div>
      );
    }

    // Review List Component
    function ReviewList({ reviews, deleteReview, user }) {
      return (
        <div className="mt-4">
          <h4 className="font-semibold">Reviews:</h4>
          {reviews.length === 0 ? (
            <p>No reviews yet.</p>
          ) : (
            reviews.map((review, index) => (
              <div key={index} className="border-t pt-2 mt-2">
                <p>
                  <strong>{review.user}</strong>: {review.rating} Stars
                </p>
                <p>{review.comment}</p>
                {user && user.username === review.user && (
                  <button
                    onClick={() => deleteReview(index)}
                    className="text-red-500 hover:underline"
                  >
                    Delete
                  </button>
                )}
              </div>
            ))
          )}
        </div>
      );
    }

    // Reading List Component
    function ReadingList({ books, readingList }) {
      return (
        <div className="mt-8">
          <h2 className="text-xl font-semibold mb-4">Your Reading List</h2>
          {readingList.length === 0 ? (
            <p>Your reading list is empty.</p>
          ) : (
            <ul className="list-disc pl-5">
              {readingList.map((bookId) => {
                const book = books.find((b) => b.id === bookId);
                return (
                  <li key={bookId}>
                    {book.title} by {book.author}
                  </li>
                );
              })}
            </ul>
          )}
        </div>
      );
    }

    // Render the app
    ReactDOM.render(<App />, document.getElementById("root"));
  </script>
</body>
</html>